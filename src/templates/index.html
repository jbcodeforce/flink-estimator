<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flink Resource Estimator</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Flink Resource Estimator</h1>
            <p class="subtitle">Estimate your Apache Flink or Confluent Platform for Flink cluster resource requirements</p>
            <div class="header-nav">
                <a href="/saved" class="nav-link">üìÇ View Saved Estimations</a>
            </div>
        </header>

        <main>
            <form action="/estimate" method="post" class="estimation-form">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button type="button" class="tab-button active" data-tab="project-workload">
                        üìä Project & Workload
                    </button>
                    <button type="button" class="tab-button" data-tab="network-hardware">
                        üåê Network & Hardware
                    </button>
                    <button type="button" class="tab-button" data-tab="statement-complexity">
                        ‚öôÔ∏è Statement Complexity
                    </button>
                    <button type="button" class="tab-button" data-tab="considerations">
                        üìã Considerations
                    </button>
                </div>

                <!-- Tab 1: Project & Workload -->
                <div class="tab-content active" id="project-workload">
                    <div class="form-section">
                        <h2>Project Information</h2>
                        <div class="form-group">
                            <label for="project_name">Project Name:</label>
                            <input 
                                type="text" 
                                id="project_name" 
                                name="project_name" 
                                required 
                                placeholder="Enter your project name"
                            >
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Workload Characteristics</h2>
                        
                        <div class="form-group">
                            <label for="messages_per_second">Expected Messages per Second:</label>
                            <input 
                                type="number" 
                                id="messages_per_second" 
                                name="messages_per_second" 
                                required 
                                min="1"
                                placeholder="e.g., 10000"
                            >
                            <div class="help-text">The expected throughput of messages your Flink job will process</div>
                        </div>

                        <div class="form-group">
                            <label for="avg_record_size_bytes">Average Record Size (bytes):</label>
                            <input 
                                type="number" 
                                id="avg_record_size_bytes" 
                                name="avg_record_size_bytes" 
                                required 
                                min="1"
                                placeholder="e.g., 1024"
                            >
                            <div class="help-text">Average size of each message/record in bytes</div>
                        </div>

                        <div class="form-group">
                            <label for="expected_latency_seconds">Expected Latency (seconds):</label>
                            <input 
                                type="number" 
                                id="expected_latency_seconds" 
                                name="expected_latency_seconds" 
                                step="0.1"
                                min="0.1"
                                value="1.0"
                                placeholder="e.g., 1.0"
                            >
                            <div class="help-text">Expected end-to-end processing latency in seconds</div>
                        </div>

                        <div class="form-group">
                            <label for="num_distinct_keys">Number of Distinct Keys:</label>
                            <input 
                                type="number" 
                                id="num_distinct_keys" 
                                name="num_distinct_keys" 
                                required 
                                min="1"
                                value="100000"
                                placeholder="e.g., 1000000"
                            >
                            <div class="help-text">Number of distinct partition keys (affects parallelism and state distribution)</div>
                        </div>

                        <div class="form-group">
                            <label for="data_skew_risk">Data Skew Risk:</label>
                            <select 
                                id="data_skew_risk" 
                                name="data_skew_risk" 
                                required
                            >
                                <option value="low">Low - Data is evenly distributed across keys</option>
                                <option value="medium" selected>Medium - Some keys have more data than others</option>
                                <option value="high">High - Significant data concentration on few keys</option>
                            </select>
                            <div class="help-text">Risk of uneven data distribution which can cause hotspots and performance issues</div>
                        </div>

  
                    </div>
                </div>

                <!-- Tab 2: Network & Hardware -->
                <div class="tab-content" id="network-hardware">
                    <div class="form-section">
                        <h2>Network Configuration</h2>
                        
                        <div class="form-group">
                            <label for="bandwidth_capacity_mbps">Network Bandwidth Capacity (Mbps):</label>
                            <input 
                                type="number" 
                                id="bandwidth_capacity_mbps" 
                                name="bandwidth_capacity_mbps" 
                                required 
                                min="1"
                                value="1000"
                                placeholder="e.g., 1000"
                            >
                            <div class="help-text">Available network bandwidth for data transfer (affects throughput limits)</div>
                        </div>
                    </div>



                    <div class="form-section">
                        <h2>Hardware Considerations</h2>
                        <div class="info-box">
                            <h3>üí° Hardware Recommendations</h3>
                            <ul>
                                <li><strong>CPU:</strong> Ensure sufficient cores for parallel processing</li>
                                <li><strong>Memory:</strong> Adequate RAM for state management and buffering</li>
                                <li><strong>Storage:</strong> Fast I/O for checkpointing and state backends</li>
                                <li><strong>Network:</strong> High bandwidth for inter-node communication</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Statement Complexity -->
                <div class="tab-content" id="statement-complexity">
                    <div class="form-section">
                        <h2>Flink Statement Complexity</h2>
                        <p class="section-description">
                            Categorize your Flink SQL statements by complexity. This helps estimate processing overhead.
                        </p>
                        
                        <div class="complexity-grid">
                            <div class="complexity-item">
                                <h3>Simple Statements</h3>
                                <p>SELECT, basic WHERE clauses, simple projections</p>
                                <input 
                                    type="number" 
                                    id="simple_statements" 
                                    name="simple_statements" 
                                    min="0" 
                                    value="0"
                                    placeholder="0"
                                >
                                <div class="complexity-examples">
                                    <strong>Examples:</strong>
                                    <ul>
                                        <li>SELECT id, name FROM users</li>
                                        <li>WHERE status = 'active'</li>
                                        <li>Basic field filtering</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="complexity-item">
                                <h3>Medium Statements</h3>
                                <p>JOINs, GROUP BY, basic window operations, aggregations</p>
                                <input 
                                    type="number" 
                                    id="medium_statements" 
                                    name="medium_statements" 
                                    min="0" 
                                    value="0"
                                    placeholder="0"
                                >
                                <div class="complexity-examples">
                                    <strong>Examples:</strong>
                                    <ul>
                                        <li>Inner/Outer JOINs</li>
                                        <li>GROUP BY with aggregations</li>
                                        <li>TUMBLE/HOP windows</li>
                                        <li>COUNT, SUM, AVG functions</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="complexity-item">
                                <h3>Complex Statements</h3>
                                <p>Advanced analytics, complex windows, nested queries, ML operations</p>
                                <input 
                                    type="number" 
                                    id="complex_statements" 
                                    name="complex_statements" 
                                    min="0" 
                                    value="0"
                                    placeholder="0"
                                >
                                <div class="complexity-examples">
                                    <strong>Examples:</strong>
                                    <ul>
                                        <li>Complex event pattern matching</li>
                                        <li>Multi-level window operations</li>
                                        <li>User-defined functions (UDFs)</li>
                                        <li>Advanced analytical queries</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Considerations -->
                <div class="tab-content" id="considerations">
                    <div class="form-section">
                        <h2>üìã Estimation Principles & Considerations</h2>
                        <p class="section-description">
                            Understanding the core principles behind this resource estimator helps you make better decisions about your Flink cluster sizing.
                        </p>
                        
                        <div class="considerations-content">
                            <div class="consideration-section">
                                <h3>üéØ Core Performance Rule</h3>
                                <div class="principle">
                                    <p><strong>Flink can process ~10,000 records per second per CPU core</strong></p>
                                    <p class="note">This baseline may decrease with larger messages, bigger state, key skew, or high number of distinct keys.</p>
                                </div>
                            </div>

                            <div class="consideration-section">
                                <h3>‚öôÔ∏è Statement Complexity Impact</h3>
                                <div class="principle">
                                    <p>Statement complexity reflects the usage of complex operators like:</p>
                                    <ul>
                                        <li>Joins between multiple streams</li>
                                        <li>Windowed aggregations</li>
                                        <li>Complex analytics functions</li>
                                    </ul>
                                    <p class="note">More complex operations require additional CPU and memory resources.</p>
                                </div>
                            </div>

                            <div class="consideration-section">
                                <h3>üèóÔ∏è Architecture Assumptions</h3>
                                <div class="principle">
                                    <ul>
                                        <li><strong>Source & Sink latency:</strong> Assumed to be minimal</li>
                                        <li><strong>Key size:</strong> Assumed to be small (few bytes)</li>
                                        <li><strong>Minimum cluster size:</strong> 3 nodes required</li>
                                        <li><strong>CPU limit:</strong> Maximum 8 CPU cores per Flink node</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="consideration-section">
                                <h3>üíæ State Management & Checkpointing</h3>
                                <div class="principle">
                                    <ul>
                                        <li><strong>Working State:</strong> Kept locally in RocksDB</li>
                                        <li><strong>Backup:</strong> State backed up to distributed storage</li>
                                        <li><strong>Recovery:</strong> Checkpoint size affects recovery time</li>
                                        <li><strong>Frequency:</strong> Checkpoint interval determines state capture frequency</li>
                                    </ul>
                                    <p class="note">Aggregate state size consumes bandwidth and impacts recovery latency.</p>
                                </div>
                            </div>

                            <div class="consideration-section">
                                <h3>üìä Resource Guidelines</h3>
                                <div class="principle">
                                    <p><strong>Typical Flink node configuration:</strong></p>
                                    <ul>
                                        <li>4 CPU cores with 16GB memory</li>
                                        <li>Should process 20-50 MB/s of data</li>
                                        <li>Jobs with significant state benefit from more memory</li>
                                    </ul>
                                    <p class="highlight">üí° <strong>Scaling Strategy:</strong> Scale vertically before horizontally</p>
                                </div>
                            </div>

                            <div class="consideration-section">
                                <h3>üéØ Estimation Heuristics</h3>
                                <div class="principle">
                                    <p>The estimator increases task managers until there are sufficient resources for:</p>
                                    <ul>
                                        <li>Expected throughput requirements</li>
                                        <li>Acceptable recovery times</li>
                                        <li>Handling data skew and key distribution</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="consideration-section warning">
                                <h3>‚ö†Ô∏è Important Notes</h3>
                                <div class="principle">
                                    <ul>
                                        <li>These are <strong>estimates</strong> - always test with your actual workload</li>
                                        <li>Start with conservative estimates and adjust based on testing</li>
                                        <li>Monitor your cluster performance and tune as needed</li>
                                        <li>Consider your specific data patterns and business requirements</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        üßÆ Calculate Resource Estimates
                    </button>
                    <button type="button" class="btn-secondary" onclick="saveEstimation()">
                        üíæ Save Configuration
                    </button>
                </div>
            </form>
        </main>

        <footer>
            <div class="footer-content">
                <p>üí° <strong>Tip:</strong> Start with conservative estimates and adjust based on your testing results.</p>
                <div class="footer-links">
                    <a href="/docs" class="footer-link">üìñ API Documentation</a>
                    <a href="https://flink.apache.org" target="_blank" class="footer-link">üîó Apache Flink</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');

                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to clicked button and corresponding content
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        });

        // Save estimation function
        function saveEstimation() {
            const form = document.querySelector('.estimation-form');
            const formData = new FormData(form);
            
            // Validate required fields
            const requiredFields = ['project_name', 'messages_per_second', 'avg_record_size_bytes', 'num_distinct_keys', 'data_skew_risk', 'bandwidth_capacity_mbps'];
            for (let field of requiredFields) {
                if (!formData.get(field)) {
                    alert(`Please fill in the ${field.replace('_', ' ')} field.`);
                    return;
                }
            }

            // Submit to save endpoint
            fetch('/save-estimation', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Configuration saved successfully!');
                } else {
                    alert('Error saving configuration: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error saving configuration: ' + error.message);
            });
        }

        // Form validation enhancement
        document.querySelector('.estimation-form').addEventListener('submit', function(e) {
            const requiredFields = document.querySelectorAll('input[required]');
            let allValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    allValid = false;
                } else {
                    field.classList.remove('error');
                }
            });

            if (!allValid) {
                e.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
    </script>
</body>
</html>